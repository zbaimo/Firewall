# ===================================================================
# Nginx智能防火墙系统 - 配置文件
# Version: 1.2.0
# 
# 所有规则配置请通过Web界面管理：
#   - 威胁检测规则: http://your-server:8080/rules
#   - 自定义规则: http://your-server:8080/rules
#   - 端口规则: http://your-server:8080/ports
#   - 防火墙规则: http://your-server:8080/firewall
# ===================================================================

# ===================================================================
# Nginx日志配置
# ===================================================================
nginx:
  access_log: "/var/log/nginx/logs/access.log"
  error_log: "/var/log/nginx/logs/error.log"
  log_format: 'combined'

# ===================================================================
# 数据库配置
# ===================================================================
database:
  type: "sqlite"
  path: "/data/firewall.db"

# ===================================================================
# Redis缓存
# ===================================================================
redis:
  enabled: true
  host: "localhost"
  port: 6379
  db: 0
  password: null

# ===================================================================
# 防火墙基础配置
# ===================================================================
firewall:
  enabled: true
  os: "auto"
  
  # 白名单（永不封禁）
  whitelist:
    - "127.0.0.1"
    - "::1"
  
  # 黑名单（直接封禁）
  blacklist: []

# ===================================================================
# 指纹识别
# ===================================================================
fingerprint:
  base_fields:
    - ip
    - user_agent
  
  behavior_fields:
    - request_path
    - request_method
    - status_code
  
  retention_days: 3

# ===================================================================
# 威胁评分系统
# ===================================================================
scoring_system:
  enabled: true
  score_decay_hours: 24
  score_decay_rate: 0.5
  
  # 封禁阈值
  ban_thresholds:
    temporary_ban: 60
    extended_ban: 100
    permanent_ban: 150
  
  # 封禁时长（秒）
  ban_durations:
    temporary_ban: 3600
    extended_ban: 86400
    permanent_ban: null

# ===================================================================
# IP地理位置
# ===================================================================
geo_location:
  enabled: true
  database_path: "GeoLite2-City.mmdb"
  anomaly_threshold: 1000

# ===================================================================
# 审计日志
# ===================================================================
audit:
  enabled: true
  file: "logs/audit.log"
  max_size_mb: 100

# ===================================================================
# 数据导出
# ===================================================================
export:
  directory: "exports"
  retention_days: 30

# ===================================================================
# 系统日志
# ===================================================================
logging:
  level: "INFO"
  file: "logs/firewall.log"
  max_size_mb: 100
  backup_count: 5

# ===================================================================
# Web管理后台
# ===================================================================
web_dashboard:
  enabled: true
  host: "0.0.0.0"
  port: 8080
  secret_key: "CHANGE_ME_TO_RANDOM_SECRET_KEY"  # ⚠️ 生产环境必须修改

# ===================================================================
# 用户认证
# ===================================================================
authentication:
  enabled: true
  password_salt: "CHANGE_ME_TO_RANDOM_SALT"     # ⚠️ 生产环境必须修改
  session_timeout_hours: 24

# ===================================================================
# 实时告警（可选）
# ===================================================================
alerts:
  enabled: false
  
  email:
    enabled: false
    smtp_host: "smtp.gmail.com"
    smtp_port: 587
    username: "your-email@gmail.com"
    password: "your-app-password"
    from_addr: "firewall@yourdomain.com"
    to_addrs:
      - "admin@yourdomain.com"
  
  webhook:
    enabled: false
    url: "https://your-webhook-url"
  
  telegram:
    enabled: false
    bot_token: "your-bot-token"
    chat_id: "your-chat-id"

# ===================================================================
# 自动解封
# ===================================================================
auto_unban:
  enabled: true
  check_interval: 300

# ===================================================================
# 📝 配置说明
# ===================================================================
#
# 🔧 所有规则配置现在通过Web界面管理：
#
#   威胁检测规则（SQL注入、XSS、扫描等）：
#     👉 http://your-server:8080/rules
#
#   自定义评分规则（时间规则、行为规则等）：
#     👉 http://your-server:8080/rules
#
#   端口规则（开放、关闭、阻止）：
#     👉 http://your-server:8080/ports
#
#   防火墙操作（封禁、解封、批量）：
#     👉 http://your-server:8080/firewall
#
# 🚀 或使用CLI工具：
#   docker exec nginx-firewall python tools/firewall_cli.py --help
#
# ⚠️ 生产环境部署前必须：
#   1. 修改 secret_key 为随机值
#   2. 修改 password_salt 为随机值
#   3. 配置正确的 nginx.access_log 路径
#   4. 在Web界面添加检测规则
#
# 📖 详细文档：
#   - README.md - 项目介绍
#   - QUICK_START.md - 快速开始
#   - IPTABLES_FIREWALL_GUIDE.md - iptables指南
#   - FIREWALL_CLI_GUIDE.md - CLI工具手册
#
# ===================================================================
